<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSphere | Newsfeed</title>
    <link rel="icon" type="image/png" href="/logo_SS.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { darkbg: '#0d1117', cardbg: '#161b22', bordercol: '#30363d', accent: '#2f81f7' } } } }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #e6edf3; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #0d1117; } ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        .nav-item.active { border-bottom: 2px solid #e6edf3; color: #fff; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="sticky top-0 z-50 bg-cardbg border-b border-bordercol px-4 h-16 flex items-center justify-center">
        <div class="max-w-7xl w-full flex items-center justify-between">
            
            <div class="flex items-center gap-4">
                 <a href="/"><img src="/logo_SS.png" alt="SocialShere Logo" class="h-10 w-auto mr-2"></a>

            </div>

            <ul class="flex items-center gap-1 sm:gap-6 text-gray-400 text-xs sm:text-sm font-medium">
                <li class="nav-item  flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2">
                    <a href="/" class="flex flex-col items-center"><svg class="w-6 h-6 mb-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg><span class="hidden md:block">Home</span></a>
                </li>
                <li class="nav-item active flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2">
                    <a href="/jobs" class="flex flex-col items-center"><svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg><span class="hidden md:block">Jobs</span></a>
                </li>
                <li class="nav-item flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2">
                    <a href="/messages" class="flex flex-col items-center"><svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg><span class="hidden md:block">Messaging</span></a>
                </li>

                <li class="nav-item flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2 relative group">
                    <img src="<%= user && user.profilePicture ? user.profilePicture : '/uploads/default-avatars/default.png' %>" alt="Me" class="w-6 h-6 rounded-full border border-gray-600 object-cover">
                    <span class="hidden md:block mt-0.5 text-xs flex items-center"><%= user ? user.username : 'Me' %> <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                    
                    <div class="hidden group-hover:block absolute top-14 right-0 w-48 bg-cardbg border border-bordercol rounded-md shadow-xl py-2 z-50">
                        <a href="profile" class="block px-4 py-2 hover:bg-gray-800 text-sm">View Profile</a>
                        <a href="#" class="block px-4 py-2 hover:bg-gray-800 text-sm">Settings</a>
                        <div class="border-t border-bordercol my-1"></div>
                        <a href="logout" id="logout-btn" class="block px-4 py-2 hover:bg-gray-800 text-sm text-red-400">
                            Sign Out
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

<div class="flex-grow max-w-7xl w-full mx-auto px-4 py-6">
    
    <div class="bg-cardbg border border-bordercol rounded-xl p-6 mb-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
            <h1 class="text-2xl font-bold text-white">Find your next dream job</h1>
            <button onclick="openPostJobModal()" class="bg-accent hover:bg-blue-600 text-white px-4 py-2 rounded-md font-medium text-sm transition flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                Post a Job
            </button>
        </div>
        
        <div class="flex flex-col md:flex-row gap-3">
            <div class="flex-grow relative">
                <svg class="w-5 h-5 absolute left-3 top-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" id="job-search" placeholder="Search by title or company" class="w-full bg-darkbg border border-bordercol rounded-md pl-10 pr-4 py-2.5 text-white focus:ring-1 focus:ring-accent outline-none">
            </div>
            <div class="md:w-1/4 relative">
                <svg class="w-5 h-5 absolute left-3 top-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <input type="text" id="location-search" placeholder="City, state, or zip" class="w-full bg-darkbg border border-bordercol rounded-md pl-10 pr-4 py-2.5 text-white focus:ring-1 focus:ring-accent outline-none">
            </div>
            
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        
<div class="md:col-span-1 space-y-4">
    <div class="bg-cardbg border border-bordercol rounded-xl overflow-hidden cursor-pointer">
        <div id="nav-all" onclick="setFilterMode('all')" class="flex items-center gap-3 px-4 py-3 bg-gray-800/50 border-l-4 border-accent text-white text-sm font-medium transition-all">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
            Job Feed
        </div>
        
        <div id="nav-applied" onclick="setFilterMode('applied')" class="flex items-center gap-3 px-4 py-3 text-gray-400 border-l-4 border-transparent hover:bg-gray-800 hover:text-white transition-all text-sm font-medium">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            Applied
        </div>


    </div>

<div class="bg-cardbg border border-bordercol rounded-xl p-4">
    <h3 class="text-white font-semibold mb-3 text-sm">Job Type</h3>
    <div class="space-y-2">
        <label class="flex items-center gap-2 text-gray-400 text-sm cursor-pointer hover:text-white">
            <input type="checkbox" value="Full-time" class="job-type-filter rounded bg-darkbg border-bordercol text-accent focus:ring-0"> 
            Full-time
        </label>
        <label class="flex items-center gap-2 text-gray-400 text-sm cursor-pointer hover:text-white">
            <input type="checkbox" value="Part-time" class="job-type-filter rounded bg-darkbg border-bordercol text-accent focus:ring-0"> 
            Part-time
        </label>
        <label class="flex items-center gap-2 text-gray-400 text-sm cursor-pointer hover:text-white">
            <input type="checkbox" value="Contract" class="job-type-filter rounded bg-darkbg border-bordercol text-accent focus:ring-0"> 
            Contract
        </label>
                <label class="flex items-center gap-2 text-gray-400 text-sm cursor-pointer hover:text-white">
            <input type="checkbox" value="Internship" class="job-type-filter rounded bg-darkbg border-bordercol text-accent focus:ring-0"> 
            Internship
        </label>
        <label class="flex items-center gap-2 text-gray-400 text-sm cursor-pointer hover:text-white">
            <input type="checkbox" value="Freelance" class="job-type-filter rounded bg-darkbg border-bordercol text-accent focus:ring-0"> 
            Freelance
        </label>
    </div>
</div>
</div>

        <div class="md:col-span-3 space-y-4" id="jobs-container">
            </div>
    </div>
</div>

<div id="post-job-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center backdrop-blur-sm">
    <div class="bg-cardbg border border-bordercol rounded-xl w-full max-w-lg p-6 relative shadow-2xl">
        <button onclick="closePostJobModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <h2 class="text-xl font-bold text-white mb-4">Post a new job</h2>
<form id="create-job-form" class="space-y-4">
    <div>
        <label class="block text-xs text-gray-400 mb-1">Job Title</label>
        <input name="title" type="text" class="w-full bg-darkbg border border-bordercol rounded p-2 text-white text-sm focus:border-accent outline-none" required>
    </div>
    <div>
        <label class="block text-xs text-gray-400 mb-1">Company Name</label>
        <input name="company" type="text" class="w-full bg-darkbg border border-bordercol rounded p-2 text-white text-sm focus:border-accent outline-none" required>
    </div>
    <div class="grid grid-cols-2 gap-4">
        <div>
            <label class="block text-xs text-gray-400 mb-1">Location</label>
            <input name="location" type="text" class="w-full bg-darkbg border border-bordercol rounded p-2 text-white text-sm focus:border-accent outline-none" placeholder="e.g. Remote">
        </div>
        <div>
            <label class="block text-xs text-gray-400 mb-1">Type</label>
            <select name="type" class="w-full bg-darkbg border border-bordercol rounded p-2 text-white text-sm focus:border-accent outline-none">
                <option>Full-time</option>
                <option>Part-time</option>
                <option>Contract</option>
                <option>Freelance</option>
                <option>Internship</option>
            </select>
        </div>
    </div>

    <div>
        <label class="block text-xs text-gray-400 mb-1">Job Description (Optional)</label>
        <textarea 
            name="description"
            rows="5" 
            class="w-full bg-darkbg border border-bordercol rounded p-2 text-white text-sm focus:border-accent outline-none resize-none" 
            placeholder="Describe the roles, responsibilities, and requirements..."
            ></textarea>
    </div>

    <button type="submit" class="w-full bg-accent hover:bg-blue-600 text-white py-2 rounded font-medium transition mt-2">Post Job Now</button>
</form>
    </div>
</div>
<div id="applyModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
    
    <div class="bg-[#1b1f23] border border-gray-700 w-full max-w-md rounded-xl shadow-2xl transform transition-all">
        <div class="p-6">
            <div class="mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-blue-900/30">
                <svg class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0" />
                </svg>
            </div>

            <h3 class="text-xl font-semibold text-gray-100">Apply for this position?</h3>
            <p class="mt-3 text-gray-400">
                Your profile and resume will be sent to the recruiter. Make sure your details are up to date before proceeding.
            </p>
        </div>

        <div class="flex justify-end gap-3 p-4 bg-[#161b22] rounded-b-xl">
            <button id="applyCancelBtn" 
                class="px-4 py-2 text-sm font-medium text-gray-300 hover:bg-gray-800 rounded-md transition-colors">
                Not now
            </button>
            <button id="confirmApplyBtn" 
                class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-500 rounded-md transition-colors shadow-sm">
                Apply Now
            </button>
        </div>
    </div>
</div>
<div id="userActionModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
    <div class="bg-[#1b1f23] border border-gray-700 w-full max-w-sm rounded-xl shadow-2xl p-6">
        <div class="flex items-center gap-3 text-red-500 mb-4">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <h3 class="text-lg font-bold text-gray-100 uppercase tracking-wide">Confirm Action</h3>
        </div>
        
        <p class="text-gray-400 text-sm leading-relaxed">
            Are you sure you want to <span id="actionTextPlaceholder" class="text-white font-semibold italic">deactivate</span> this job? It will be hidden from the feed.
        </p>

        <div class="flex justify-end gap-3 mt-8">
            <button id="userActionCancelBtn" class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white transition-colors">
                Cancel
            </button>
            <button id="userActionConfirmBtn" class="px-5 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-500 rounded-lg transition-all shadow-lg shadow-red-900/20">
                Confirm
            </button>
        </div>
    </div>
</div>
<script type="application/json" id="jobs-data">
  <%- JSON.stringify(jobs) %>
</script>

   <script>
   
  
    const allJobs = JSON.parse(
    document.getElementById("jobs-data").textContent
  );
    
   
    const jobsContainer = document.getElementById('jobs-container');
    const modal = document.getElementById('post-job-modal');
    
    
    let currentFilterMode = 'all'; 

    

    function renderJobs(jobList) {
        if (!jobList || jobList.length === 0) {
            jobsContainer.innerHTML = `
                <div class="text-center py-12 text-gray-500 bg-cardbg rounded-xl border border-bordercol">
                    <p class="text-lg">No jobs found.</p>
                    <button onclick="openPostJobModal()" class="text-accent hover:underline mt-2 text-sm">Post the first one!</button>
                </div>`;
            return;
        }

        jobsContainer.innerHTML = jobList.map(job => {
            let buttonHTML;

           
            if (job.isOwner) {
                buttonHTML = `
                    <button 
                        onclick="deactivateJob('${job._id}')"
                        class="transition-all px-4 py-1.5 rounded-full text-sm font-medium border border-red-500/50 text-red-400 hover:bg-red-500 hover:text-white">
                        Deactivate
                    </button>`;
            }
            
            else if (job.hasApplied) {
                buttonHTML = `
                    <button disabled class="bg-green-900/30 border border-green-600 text-green-500 cursor-not-allowed px-4 py-1.5 rounded-full text-sm font-medium">
                        Applied
                    </button>`;
            } 
           
            else {
                buttonHTML = `
                    <button onclick="applyForJob('${job._id}')" class="bg-darkbg border border-accent text-accent hover:bg-accent hover:text-white px-4 py-1.5 rounded-full text-sm font-medium transition">
                        Apply
                    </button>`;
            }

            return `
                <div class="bg-cardbg border border-bordercol rounded-xl p-5 hover:border-gray-500 transition group relative">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded ${job.logo || 'bg-blue-600'} flex items-center justify-center text-white font-bold text-lg shrink-0 uppercase">
                            ${job.company.charAt(0)}
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-accent group-hover:underline cursor-pointer">${job.title}</h3>
                            <p class="text-sm text-gray-300">${job.company}</p>
                            
                            <div class="flex items-center gap-3 mt-2 text-xs text-gray-500">
                                <span class="flex items-center gap-1">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> 
                                    ${job.location}
                                </span>
                                <span>•</span>
                                <span>${job.type}</span>
                                <span>•</span>
                                <span class="text-green-400">${job.time}</span>
                            </div>

                            ${job.description && job.description.trim() !== "" 
                                                ? `<div class="text-gray-400 line-clamp-2">${job.description}</div>` 
                                                : `<div class="text-gray-600 italic">No description added.</div>`
                                            }
                        </div>
                        ${buttonHTML}
                    </div>
                </div>
                `;
        }).join('');
    }

   
    function setFilterMode(mode) {
        currentFilterMode = mode;
        
        const allBtn = document.getElementById('nav-all');
        const appliedBtn = document.getElementById('nav-applied');
        const activeClasses = ['bg-gray-800/50', 'border-accent', 'text-white'];
        const inactiveClasses = ['text-gray-400', 'border-transparent'];

        if (mode === 'all') {
            allBtn.classList.add(...activeClasses);
            allBtn.classList.remove(...inactiveClasses);
            appliedBtn.classList.remove(...activeClasses);
            appliedBtn.classList.add(...inactiveClasses);
        } else {
            appliedBtn.classList.add(...activeClasses);
            appliedBtn.classList.remove(...inactiveClasses);
            allBtn.classList.remove(...activeClasses);
            allBtn.classList.add(...inactiveClasses);
        }
        filterJobs();
    }

   
    function filterJobs() {
        if (typeof allJobs === 'undefined') return;

        const titleQuery = document.getElementById('job-search').value.toLowerCase();
        const locQuery = document.getElementById('location-search').value.toLowerCase();
        
       
        const checkedTypes = Array.from(document.querySelectorAll('.job-type-filter:checked'))
                                  .map(cb => cb.value);

       
        let results = allJobs;

      
        if (currentFilterMode === 'applied') {
            results = results.filter(job => job.hasApplied === true);
        }

        
        results = results.filter(job => {
            const matchTitle = job.title.toLowerCase().includes(titleQuery) || 
                               job.company.toLowerCase().includes(titleQuery);
            const matchLoc = job.location.toLowerCase().includes(locQuery);
            return matchTitle && matchLoc;
        });

       
        if (checkedTypes.length > 0) {
            results = results.filter(job => checkedTypes.includes(job.type));
        }
        
        renderJobs(results);
    }

   
    
    renderJobs(allJobs); 

    
    const searchInput = document.getElementById('job-search');
    const locInput = document.getElementById('location-search');
    if (searchInput) searchInput.addEventListener('input', filterJobs);
    if (locInput) locInput.addEventListener('input', filterJobs);


    const typeCheckboxes = document.querySelectorAll('.job-type-filter');
    typeCheckboxes.forEach(box => {
        box.addEventListener('change', filterJobs);
    });

    
    function openPostJobModal() {
        modal.classList.remove('hidden');
    }
    
    function closePostJobModal() {
        modal.classList.add('hidden');
    }
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closePostJobModal();
    });

    const jobForm = document.getElementById('create-job-form');
    if (jobForm) {
        jobForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = jobForm.querySelector('button[type="submit"]');
            btn.innerText = "Posting...";
            btn.disabled = true;

            
            const formData = new FormData(jobForm);
            const payload = Object.fromEntries(formData.entries());

            try {
                const res = await fetch('/jobs/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                if (data.success) window.location.reload();
                else alert(data.message || 'Error');
            } catch (err) {
                console.error(err);
                alert('Network error');
            } finally {
                btn.innerText = "Post Job Now";
                btn.disabled = false;
            }
        });
    }

    
    const applyModal = document.getElementById('applyModal');
const applyCancelBtn = document.getElementById('applyCancelBtn');
const confirmApplyBtn = document.getElementById('confirmApplyBtn');

function confirmApplication() {
    return new Promise((resolve) => {
        applyModal.classList.remove('hidden');

        const handleConfirm = () => {
            closeModal();
            resolve(true);
        };

        const handleCancel = () => {
            closeModal();
            resolve(false);
        };

        const closeModal = () => {
            applyModal.classList.add('hidden');
            confirmApplyBtn.removeEventListener('click', handleConfirm);
            applyCancelBtn.removeEventListener('click', handleCancel);
        };

        confirmApplyBtn.addEventListener('click', handleConfirm);
        applyCancelBtn.addEventListener('click', handleCancel);
    });
}
    async function applyForJob(jobId) {
        const shouldApply = await confirmApplication();
        if (!shouldApply) return;


        try {
            const res = await fetch(`/jobs/apply/${jobId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();
            if (data.success) window.location.reload();
            else alert(data.message);
        } catch (err) {
            console.error(err);
            alert("Network error");
        }
    }


function confirmUserAction(action) {
    const modal = document.getElementById('userActionModal');
    const actionText = document.getElementById('actionTextPlaceholder');
    const confirmBtn = document.getElementById('userActionConfirmBtn');
    const cancelBtn = document.getElementById('userActionCancelBtn');

    return new Promise((resolve) => {
        
        actionText.textContent = action;
        
        
        modal.classList.remove('hidden');

        const close = (result) => {
            modal.classList.add('hidden');
        
            confirmBtn.onclick = null;
            cancelBtn.onclick = null;
            resolve(result);
        };

        confirmBtn.onclick = () => close(true);
        cancelBtn.onclick = () => close(false);
        
      
        modal.onclick = (e) => {
            if (e.target === modal) close(false);
        };
    });
}

    async function deactivateJob(jobId) {
    
    const confirmed = await confirmUserAction('deactivate');
    if (!confirmed) return;

    try {
       
        const res = await fetch(`/jobs/deactivate/${jobId}`, {
            method: 'PUT',
            headers: { 
                'Content-Type': 'application/json',
               
            },
            credentials: 'include'
        });

        const data = await res.json();

        if (data.success) {
            
            window.location.reload();
        } else {
            alert(data.message || 'Failed to deactivate job');
        }
    } catch (err) {
        console.error("Communication error:", err);
        alert('Network error - check console');
    }
}
</script>
</body>
</html>