<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSphere | Newsfeed</title>
    <link rel="icon" type="image/png" href="/logo_SS.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { darkbg: '#0d1117', cardbg: '#161b22', bordercol: '#30363d', accent: '#2f81f7' } } } }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #e6edf3; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #0d1117; } ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        .nav-item.active { border-bottom: 2px solid #e6edf3; color: #fff; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<nav class="sticky top-0 z-50 bg-cardbg border-b border-bordercol px-4 h-16 flex items-center justify-center">
    <div class="max-w-7xl w-full flex items-center justify-between">
        
        <div class="flex items-center gap-4">
            <a href="/">
                <img src="/logo_SS.png" alt="SocialShere Logo" class="h-10 w-auto mr-2">
            </a>

            <div class="hidden md:flex items-center bg-darkbg border border-bordercol rounded-md px-3 py-1.5 w-64 transition focus-within:ring-2 focus-within:ring-accent focus-within:border-transparent relative">
                <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" id="search-input" placeholder="Search users..." class="bg-transparent border-none outline-none text-sm text-white w-full placeholder-gray-500">
                
                <div id="search-dropdown" class="absolute top-full left-0 right-0 bg-cardbg border border-bordercol rounded-md shadow-xl mt-1 z-50 max-h-64 overflow-y-auto hidden">
                    </div>
            </div>
        </div>

        <ul class="flex items-center gap-1 sm:gap-6 text-gray-400 text-xs sm:text-sm font-medium">
            
            <li class="nav-item active flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2">
                <a href="/" class="flex flex-col items-center">
                    <svg class="w-6 h-6 mb-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                    <span class="hidden md:block">Home</span>
                </a>
            </li>

            <li class="nav-item flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2">
                <a href="/jobs" class="flex flex-col items-center">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span class="hidden md:block">Jobs</span>
                </a>
            </li>

            <li class="nav-item flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2">
                <a href="/messages" class="flex flex-col items-center">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                    <span class="hidden md:block">Messaging</span>
                </a>
            </li>

            <li class="nav-item flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2 relative group">
                <div class="relative">
                    <svg class="w-6 h-6 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM21 12V9a6 6 0 00-12 0v3l-3 3v2h18v-2l-3-3z"></path>
                    </svg>
                    <span id="notification-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                </div>
                <span class="hidden md:block mt-0.5 text-xs">Notifications</span>
                
                <div id="notifications-dropdown" class="hidden absolute top-14 right-0 w-80 bg-cardbg border border-bordercol rounded-md shadow-xl py-2 z-50 max-h-96 overflow-y-auto">
                    <div class="px-4 py-2 border-b border-bordercol">
                        <h3 class="font-semibold text-sm">Connection Requests</h3>
                    </div>
                    <div id="notifications-list" class="py-2">
                        <div class="px-4 py-3 text-center text-gray-400 text-sm">
                            No new notifications
                        </div>
                    </div>
                </div>
            </li>

            <li class="nav-item flex flex-col items-center cursor-pointer hover:text-white transition h-16 justify-center px-2 relative group">
                <img src="<%= user && user.profilePicture ? user.profilePicture : '/uploads/default-avatars/default.png' %>" alt="Me" class="w-6 h-6 rounded-full border border-gray-600 object-cover">
                <span class="hidden md:block mt-0.5 text-xs flex items-center"><%= user ? user.username : 'Me' %> <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                
                <div class="hidden group-hover:block absolute top-14 right-0 w-48 bg-cardbg border border-bordercol rounded-md shadow-xl py-2 z-50">
                    <a href="profile" class="block px-4 py-2 hover:bg-gray-800 text-sm">View Profile</a>
                    <a href="#" class="block px-4 py-2 hover:bg-gray-800 text-sm">Settings</a>
                    <div class="border-t border-bordercol my-1"></div>
                    <a href="logout" id="logout-btn" class="block px-4 py-2 hover:bg-gray-800 text-sm text-red-400">
                        Sign Out
                    </a>
                </div>
            </li>
        </ul>

    </div>
</nav>

    <div class="flex-grow max-w-7xl w-full mx-auto px-0 sm:px-4 py-6 grid grid-cols-1 md:grid-cols-12 gap-6">

        <aside class="hidden md:block md:col-span-3 lg:col-span-3 space-y-4">
            <div class="bg-cardbg rounded-xl border border-bordercol overflow-hidden relative">
                <div class="h-16 bg-gradient-to-r from-blue-900 to-gray-900"></div>
                <div class="px-4 pb-4 text-center">
                    <div class="relative -mt-8 mb-3 flex justify-center">
                        <a href="/profile"><img src="<%= user && user.profilePicture ? user.profilePicture : '/uploads/default-avatars/default.png' %>" class="w-16 h-16 rounded-full border-2 border-cardbg cursor-pointer hover:opacity-90 object-cover"></a>
                    </div>
                    
                    <a href="/profile" class="font-semibold hover:underline"><%= user ? user.username : 'User' %></a>
                    <p class="text-xs text-gray-400 mt-1"><%= user && user.headline ? user.headline : 'No headline provided' %></p>
                    <div class="border-t border-bordercol my-4"></div>
                    <div class="text-left text-xs font-medium space-y-2">
                        <div class="flex justify-between items-center hover:bg-gray-800/50 p-1 rounded cursor-pointer">
                            <span class="text-gray-400">Profile viewers</span><span class="text-accent" id="profile_viewers_count"></span>
                        </div>
                        <div class="flex justify-between items-center hover:bg-gray-800/50 p-1 rounded cursor-pointer">
                            <span class="text-gray-400">Connections</span><span class="text-accent" id="connections-count"></span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="col-span-1 md:col-span-9 lg:col-span-6 space-y-4">
       
<div id="post-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-cardbg rounded-xl border border-bordercol w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
        <div class="flex items-center justify-between p-4 border-b border-bordercol shrink-0">
            <h2 class="text-lg font-semibold">Create Post</h2>
            <button id="close-modal" class="text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <form id="post-form" class="p-4 flex flex-col flex-1 overflow-y-auto">
            <div class="flex gap-3 mb-4">
                <img src="<%= user && user.profilePicture ? user.profilePicture : '/uploads/default-avatars/default.png' %>" class="w-12 h-12 rounded-full border border-gray-600 object-cover shrink-0">
                <div class="flex-1">
                    <div class="font-semibold text-sm mb-2"><%= user ? user.username : 'User' %></div>
                    <textarea id="post-content" placeholder="What's on your mind?" class="w-full bg-darkbg border border-bordercol rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent resize-none" rows="3"></textarea>
                    
                    <div id="image-preview-container" class="hidden mt-3 relative inline-block">
                        <img id="image-preview" src="" class="max-h-60 rounded-lg border border-gray-700 object-cover">
                        <button type="button" id="remove-image-btn" class="absolute top-2 right-2 bg-black bg-opacity-75 text-white rounded-full p-1 hover:bg-opacity-100 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center mt-auto pt-2">
                <div class="flex gap-2">
                    <input type="file" id="post-image-input" accept="image/*" class="hidden">
                    
                    <button type="button" id="add-photo-btn" class="flex items-center gap-2 p-2 hover:bg-gray-800 rounded text-gray-400 hover:text-blue-400 transition text-sm font-medium">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        Photo
                    </button>
                </div>
                <button type="submit" id="post-submit-btn" class="bg-accent hover:bg-blue-600 text-white px-6 py-2 rounded-full text-sm font-medium transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>Post</button>
            </div>
        </form>
    </div>
</div>

            <div class="bg-cardbg rounded-xl border border-bordercol p-4">
                <div class="flex gap-3 mb-3">
                    <img src="<%= user && user.profilePicture ? user.profilePicture : '/uploads/default-avatars/default.png' %>" class="w-12 h-12 rounded-full border border-gray-600 object-cover">
                    <button id="start-post-btn" class="flex-grow text-left px-4 py-3 rounded-full border border-gray-600 hover:bg-gray-800 text-gray-400 font-medium text-sm transition">
                        Start a post, <%= user ? user.username : 'there' %>...
                    </button>
                </div>

            </div>

            <div class="flex items-center justify-between text-xs text-gray-400 px-1">
                <div class="border-t border-bordercol flex-grow mr-2"></div>
                <span>Sort by: <span class="font-bold text-white cursor-pointer">Top</span></span>
            </div>

            <% if (posts && posts.length > 0) { %>
                <% posts.forEach(post => { %>
                    <article class="bg-cardbg rounded-xl border border-bordercol overflow-hidden" data-post-id="<%= post._id %>">
                        <div class="p-4 flex gap-3">
                            <a href="/profile/<%= post.user ? post.user.username : '' %>"><img src="<%= post.user && post.user.profilePicture ? post.user.profilePicture : '/uploads/default-avatars/default.png' %>" class="w-12 h-12 rounded-full cursor-pointer object-cover"></a>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-semibold text-sm hover:text-accent cursor-pointer hover:underline"><a href="/profile/<%= post.user ? post.user.username : '' %>" class="hover:text-accent"><%= post.user ? post.user.username : 'Anonymous' %></a></h3>
                                        <p class="text-xs text-gray-400"><%= new Date(post.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></p>
                                    </div>
                                    <% if ( post.user && user &&( post.user._id.toString() === user._id.toString() || user.isAdmin )){%>
                                  <div class="relative inline-block text-left">
    
                                            <button 
                                                id="menu-btn-<%= post._id %>" 
                                                onclick="toggleMenu('<%= post._id %>', event)" 
                                                type="button" 
                                                class="text-gray-400 hover:text-white focus:outline-none"
                                            >
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                                </svg>
                                            </button>

                                            <div 
                                                id="menu-dropdown-<%= post._id %>" 
                                                class="hidden absolute right-0 mt-2 w-48 bg-gray-800 border border-gray-700 rounded-md shadow-lg z-50"
                                            >
                                                <div class="py-1">
                                                    <button 
                                                        class="block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-gray-700 hover:text-red-400" 
                                                        onclick="deletePost('<%= post._id %>')"
                                                    >
                                                        Delete Post
                                                    </button>
                                                </div>
                                            </div>
                            </div>
                            <%}%>
                                </div>
                                <div class="mt-2 text-sm text-gray-200">
                                    <%= post.content %>
                                </div>
                            </div>
                        </div>
                        
                        <% if (post.image) { %>
                            <div class="bg-black w-full h-64 flex items-center justify-center overflow-hidden">
                                <img src="<%= post.image %>" class="w-full h-full object-cover opacity-80 hover:opacity-100 transition">
                            </div>
                        <% } %>

                        <div class="px-4 py-2 text-xs text-gray-400 border-b border-bordercol flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <span class="hover:text-accent hover:underline cursor-pointer likes-count">0 likes</span>
                                <span class="hover:text-accent hover:underline cursor-pointer comments-count">0 comments</span>
                            </div>
                        </div>

                        <div class="flex justify-between px-2 py-1">
                            <button class="like-btn flex items-center gap-2 px-4 py-3 rounded hover:bg-gray-800 text-gray-400 hover:text-white transition text-sm font-semibold group action-btn" data-post-id="<%= post._id %>">
                                <svg class="w-5 h-5 group-hover:scale-110 transition fill-none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg> Like
                            </button>
                            <button class="comment-btn flex items-center gap-2 px-4 py-3 rounded hover:bg-gray-800 text-gray-400 hover:text-white transition text-sm font-semibold group" data-post-id="<%= post._id %>">
                                <svg class="w-5 h-5 group-hover:scale-110 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg> Comment
                            </button>
                           
                        </div>

                        <!-- Comments Section -->
                        <div class="comments-section border-t border-bordercol hidden" data-post-id="<%= post._id %>">
                            <div class="comments-list px-4 py-2 max-h-64 overflow-y-auto">
                                
                            </div>

                            <!-- Add Comment Form -->
                            <div class="px-4 py-3 border-t border-bordercol">
                                <div class="flex gap-3">
                                    <img src="<%= user && user.profilePicture ? user.profilePicture : '/uploads/default-avatars/default.png' %>" alt="Your avatar" class="w-8 h-8 rounded-full flex-shrink-0 object-cover">
                                    <div class="flex-1">
                                        <div class="flex gap-2">
                                            <input type="text" placeholder="Write a comment..." class="comment-input flex-1 bg-darkbg border border-bordercol rounded-full px-4 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent" data-post-id="<%= post._id %>">
                                            <button class="comment-submit-btn bg-accent hover:bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-medium transition disabled:opacity-50 disabled:cursor-not-allowed" data-post-id="<%= post._id %>" disabled>Post</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </article>
                <% }); %>
            <% } else { %>
                <article class="bg-cardbg rounded-xl border border-bordercol p-6 text-center">
                    <p class="text-gray-400">No posts yet. Be the first to share something! ðŸš€</p>
                </article>
            <% } %>

        </main>

        <aside class="hidden lg:block lg:col-span-3 space-y-4">
            <div class="bg-cardbg rounded-xl border border-bordercol p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-gray-200 text-sm">SocialSphere News</h3>
                    <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                </div>
                <ul class="space-y-4">
                    <li class="cursor-pointer group"><a href="404.html">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-gray-500 group-hover:bg-accent"></span>
                            <span class="text-sm font-medium group-hover:text-accent group-hover:underline">AI Regulation Talks</span>
                        </div>
                        <p class="text-xs text-gray-500 pl-4">Top news â€¢ 10,934 readers</p>
                    </a></li>
                    <li class="cursor-pointer group"><a href="404.html">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-gray-500 group-hover:bg-accent"></span>
                            <span class="text-sm font-medium group-hover:text-accent group-hover:underline">Tech hiring stabilizes</span>
                        </div>
                        <p class="text-xs text-gray-500 pl-4">Jobs â€¢ 8,102 readers</p>
                    </a></li>
                    <li class="cursor-pointer group"><a href="404.html">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-gray-500 group-hover:bg-accent"></span>
                            <span class="text-sm font-medium group-hover:text-accent group-hover:underline">New CSS features</span>
                        </div>
                        <p class="text-xs text-gray-500 pl-4">Web Dev â€¢ 4,221 readers</p>
                    </a></li>
                </ul>
                <button class="mt-4 text-xs text-gray-400 hover:text-white flex items-center">
                    Show more <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
            </div>

            <div class="text-xs text-center text-gray-500 px-4">
                <p>About â€¢ Accessibility â€¢ Help Center</p>
                <p class="mt-1">Privacy & Terms â€¢ Ad Choices</p>
                <p class="mt-2"> SocialSphere Corporation Â© 2024</p>
            </div>
        </aside>

    </div>


    <div id="deleteModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
    
    <div class="bg-[#1b1f23] border border-gray-700 w-full max-w-md rounded-xl shadow-2xl transform transition-all">
        <div class="p-6">
            <h3 class="text-xl font-semibold text-gray-100">Delete Post</h3>
            <p class="mt-3 text-gray-400">
                Are you sure you want to delete this post? This action cannot be undone and will be removed from the SocialSphere feed.
            </p>
        </div>

        <div class="flex justify-end gap-3 p-4 bg-[#161b22] rounded-b-xl">
            <button id="cancelBtn" 
                class="px-4 py-2 text-sm font-medium text-gray-300 hover:bg-gray-800 rounded-md transition-colors">
                Cancel
            </button>
            <button id="confirmDeleteBtn" 
                class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-500 rounded-md transition-colors shadow-sm">
                Delete Post
            </button>
        </div>
    </div>
</div>

    <script>

  


    // --- TOAST MESSAGE FUNCTION ---
    function displayMessage(message, type) {
        
        
        let messageBox = document.getElementById('message-box');
        if (!messageBox) {
            messageBox = document.createElement('div');
            messageBox.id = 'message-box';
            messageBox.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 z-50 p-3 px-6 max-w-sm rounded-full text-sm font-regular shadow-xl opacity-90 transition-all duration-300';
            document.body.appendChild(messageBox);
        }

        messageBox.textContent = message;
        messageBox.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 z-50 p-3 px-6 max-w-sm rounded-full text-sm font-regular shadow-xl opacity-90 transition-all duration-300';
        
        if (type === 'error') {
            messageBox.classList.add('bg-red-600', 'text-white');
        } else if (type === 'success') {
            messageBox.classList.add('bg-green-600', 'text-white');
        } else {
             messageBox.classList.add('bg-gray-800', 'text-white');
        }

        messageBox.classList.remove('hidden');
        
        setTimeout(() => {
            messageBox.classList.add('hidden');
            setTimeout(() => messageBox.className = 'hidden', 300); 
        }, 5000);
    }
     

   

    // --- LOGOUT LOGIC ---
    const logoutBtn = document.getElementById('logout-btn');

    if (logoutBtn) {
        logoutBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
               
                const response = await fetch('/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                  
                    displayMessage('Logging out...', 'success');
                    
                   
                    setTimeout(() => {
                        window.location.reload();
                    }, 500); // Small delay to let them see the toast (optional)
                } else {
                    console.error('Logout failed on server');
                }
            } catch (error) {
                console.error('Error logging out:', error);
                // Fallback: Force redirect anyway if server fails
                window.location.href = '/';
            }
        });
    }
    function toggleMenu(postId, event) {
        // Stop the click from registering on the window immediately
        event.stopPropagation(); 

        const menu = document.getElementById(`menu-dropdown-${postId}`);
        
        // Close all OTHER open menus first (optional, but good UX)
        document.querySelectorAll('[id^="menu-dropdown-"]').forEach(el => {
            if (el.id !== `menu-dropdown-${postId}`) {
                el.classList.add('hidden');
            }
        });

        // Toggle the clicked menu
        menu.classList.toggle('hidden');
    }

    // 2. Close menus when clicking anywhere else on the page
    window.addEventListener('click', () => {
        document.querySelectorAll('[id^="menu-dropdown-"]').forEach(menu => {
            if (!menu.classList.contains('hidden')) {
                menu.classList.add('hidden');
            }
        });
    });

    // 3. Handle Deletion

    const deleteModal = document.getElementById('deleteModal');
const cancelBtn = document.getElementById('cancelBtn');
const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

/**
 * 2. Define the function that replaces the native confirm()
 * Returns a Promise: true if deleted, false if cancelled.
 */
function confirmDeletion() {
    return new Promise((resolve) => {
        // Show the modal by removing 'hidden'
        deleteModal.classList.remove('hidden');

        const handleConfirm = () => {
            closeModal();
            resolve(true); // User clicked Delete
        };

        const handleCancel = () => {
            closeModal();
            resolve(false); // User clicked Cancel
        };

        const closeModal = () => {
            // Hide the modal by adding 'hidden'
            deleteModal.classList.add('hidden');
            
            // Clean up listeners so they don't stack up
            confirmDeleteBtn.removeEventListener('click', handleConfirm);
            cancelBtn.removeEventListener('click', handleCancel);
        };

        // Attach listeners
        confirmDeleteBtn.addEventListener('click', handleConfirm);
        cancelBtn.addEventListener('click', handleCancel);
    });
}
   async function  deletePost(postId) {
        const confirmed = await confirmDeletion();
        if(confirmed) {
            console.log("Deleting post:", postId);
            
            // Example Fetch request to your backend
            fetch(`/post/${postId}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    // Remove the post from the HTML immediately without refresh
                    const article = document.querySelector(`article[data-post-id="${postId}"]`);
                    if(article) article.remove();
                } else {
                    displayMessage("Failed to delete post","error");
                }
            })
            .catch(err => console.error(err));
        }
    }

        // Like Button Logic
        const likeButtons = document.querySelectorAll('.like-btn');
        likeButtons.forEach(btn => {
            btn.addEventListener('click', async function() {
                const postId = this.getAttribute('data-post-id');
                const icon = this.querySelector('svg');
                const likesCountSpan = this.closest('article').querySelector('.likes-count');
                const isLiked = this.classList.contains('liked');

                try {
                    const response = await fetch(`/post/like/${postId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Update UI
                        if (data.liked) {
                            // Now liked
                            this.classList.add('liked', 'text-blue-500');
                            this.classList.remove('text-gray-400');
                            icon.classList.remove('fill-none');
                            icon.classList.add('fill-current');
                            icon.style.transform = 'scale(1.2)';
                            setTimeout(() => icon.style.transform = 'scale(1)', 200);
                        } else {
                            // Now unliked
                            this.classList.remove('liked', 'text-blue-500');
                            this.classList.add('text-gray-400');
                            icon.classList.add('fill-none');
                            icon.classList.remove('fill-current');
                        }

                        // Update likes count
                        likesCountSpan.textContent = `${data.likesCount} likes`;
                    } else {
                        displayMessage(data.message || 'Failed to like post', 'error');
                    }
                } catch (error) {
                    console.error('Like error:', error);
                    displayMessage('Network error', 'error');
                }
            });
        });

        // --- NOTIFICATIONS FUNCTIONALITY ---
        async function loadNotifications() {
            try {
                const response = await fetch('/user/notifications');
                const data = await response.json();
                
                if (data.success) {
                    updateNotificationsUI(data.notifications);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function updateNotificationsUI(notifications) {
            const notificationCount = document.getElementById('notification-count');
            const notificationsList = document.getElementById('notifications-list');
            
            if (notifications.length > 0) {
                notificationCount.textContent = notifications.length;
                notificationCount.classList.remove('hidden');
                
                const notificationsHtml = notifications.map(notification => `
                    <div class="px-4 py-3 border-b border-bordercol last:border-b-0 hover:bg-gray-800/50">
                        <div class="flex items-center gap-3">
                            <img src="${notification.requester.profilePicture || '/uploads/default-avatars/default.png'}" 
                                 class="w-10 h-10 rounded-full border border-gray-600 object-cover">
                            <div class="flex-1">
                                <p class="text-sm font-medium">
                                    <span class="text-accent">${notification.requester.username}</span> wants to connect
                                </p>
                                <p class="text-xs text-gray-400">${new Date(notification.createdAt).toLocaleDateString()}</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="accept-notification-btn px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-xs rounded transition" 
                                        data-connection-id="${notification._id}">
                                    Accept
                                </button>
                                <button class="decline-notification-btn px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition" 
                                        data-connection-id="${notification._id}">
                                    Decline
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                notificationsList.innerHTML = notificationsHtml;
                
                // Add event listeners for accept/decline buttons
                document.querySelectorAll('.accept-notification-btn').forEach(btn => {
                    btn.addEventListener('click', handleAcceptNotification);
                });
                document.querySelectorAll('.decline-notification-btn').forEach(btn => {
                    btn.addEventListener('click', handleDeclineNotification);
                });
            } else {
                notificationCount.classList.add('hidden');
                notificationsList.innerHTML = '<div class="px-4 py-3 text-center text-gray-400 text-sm">No new notifications</div>';
            }
        }

        async function handleAcceptNotification(event) {
            const connectionId = event.target.getAttribute('data-connection-id');
            
            try {
                const response = await fetch(`/user/connection/accept/${connectionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayMessage('Connection request accepted!', 'success');
                    loadNotifications(); // Refresh notifications
                } else {
                    displayMessage(data.message || 'Failed to accept request', 'error');
                }
            } catch (error) {
                console.error('Accept notification error:', error);
                displayMessage('Network error', 'error');
            }
        }

        async function handleDeclineNotification(event) {
            const connectionId = event.target.getAttribute('data-connection-id');
            
            try {
                const response = await fetch(`/user/connection/decline/${connectionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayMessage('Connection request declined!', 'success');
                    loadNotifications(); // Refresh notifications
                } else {
                    displayMessage(data.message || 'Failed to decline request', 'error');
                }
            } catch (error) {
                console.error('Decline notification error:', error);
                displayMessage('Network error', 'error');
            }
        }

        // Toggle notifications dropdown
        const notificationsIcon = document.querySelector('.nav-item:has(#notification-count)').parentElement;
        if (notificationsIcon) {
            notificationsIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                const dropdown = document.getElementById('notifications-dropdown');
                if (dropdown) {
                    dropdown.classList.toggle('hidden');
                    
                    // Load notifications when opening dropdown
                    if (!dropdown.classList.contains('hidden')) {
                        loadNotifications();
                    }
                }
            });
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('notifications-dropdown');
            if (dropdown && !dropdown.contains(e.target) && !e.target.closest('.nav-item:has(#notification-count)')) {
                dropdown.classList.add('hidden');
            }
        });

        // Load notifications on page load
        loadNotifications();

        // Search functionality
        const searchInput = document.getElementById('search-input');
        const searchDropdown = document.getElementById('search-dropdown');
        let searchTimeout;

        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            clearTimeout(searchTimeout);
            
            if (query.length < 2) {
                searchDropdown.classList.add('hidden');
                return;
            }

            searchTimeout = setTimeout(() => {
                searchUsers(query);
            }, 300); // Debounce for 300ms
        });

        async function searchUsers(query) {
            try {
                const response = await fetch(`/user/search/${encodeURIComponent(query)}`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success && data.users.length > 0) {
                    displaySearchResults(data.users);
                } else {
                    searchDropdown.innerHTML = '<div class="px-4 py-3 text-center text-gray-400 text-sm">No users found</div>';
                    searchDropdown.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Search error:', error);
                searchDropdown.innerHTML = '<div class="px-4 py-3 text-center text-gray-400 text-sm">Error searching users</div>';
                searchDropdown.classList.remove('hidden');
            }
        }

        function displaySearchResults(users) {
            const resultsHtml = users.map(user => `
                <a href="/profile/${encodeURIComponent(user.username)}" class="flex items-center px-4 py-3 hover:bg-gray-800/50 cursor-pointer border-b border-bordercol last:border-b-0">
                    <img src="${user.profilePicture || '/uploads/default-avatars/default.png'}" alt="${user.username}" class="w-8 h-8 rounded-full mr-3 object-cover">
                    <span class="text-sm text-white">${user.username}</span>
                </a>
            `).join('');
            
            searchDropdown.innerHTML = resultsHtml;
            searchDropdown.classList.remove('hidden');
        }

        // Close search dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
                searchDropdown.classList.add('hidden');
            }
        });

        // Hide dropdown on escape key
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                searchDropdown.classList.add('hidden');
            }
        });

        // Handle comment button click to toggle comments section
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('comment-btn') || e.target.closest('.comment-btn')) {
                const postId = e.target.closest('.comment-btn')?.dataset.postId || e.target.dataset.postId;
                if (postId) {
                    const commentsSection = document.querySelector(`.comments-section[data-post-id="${postId}"]`);
                    commentsSection.classList.toggle('hidden');
                }
            }
        });
        // Load comments for all posts on page load
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.comments-section').forEach(section => {
                const postId = section.dataset.postId;
                loadComments(postId);
            });
            // Load comment counts for all posts
            loadAllCommentCounts();
            // Load likes info for all posts
            loadAllLikesInfo();
            updateConnectionsCountFromServer();
            updateProfileviewsCountFromServer();

            
        });

        // Handle comment input
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('comment-input')) {
                const submitBtn = e.target.closest('.comments-section').querySelector('.comment-submit-btn');
                submitBtn.disabled = e.target.value.trim().length === 0;
            }
        });

        // Handle comment submission
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('comment-submit-btn') && !e.target.disabled) {
                const postId = e.target.dataset.postId;
                const input = e.target.closest('.comments-section').querySelector('.comment-input');
                const text = input.value.trim();

                if (text) {
                    await addComment(postId, text);
                    input.value = '';
                    e.target.disabled = true;
                }
            }
        });

        // Handle Enter key for comment submission
        document.addEventListener('keydown', (e) => {
            if (e.target.classList.contains('comment-input') && e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const submitBtn = e.target.closest('.comments-section').querySelector('.comment-submit-btn');
                if (!submitBtn.disabled) {
                    submitBtn.click();
                }
            }
        });

        // Handle comment deletion
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-comment-btn') || e.target.closest('.delete-comment-btn')) {
                const commentId = e.target.closest('.delete-comment-btn')?.dataset.commentId || e.target.dataset.commentId;
                if (commentId) {
                    await deleteComment(commentId);
                }
            }
        });
        async function updateProfileviewsCountFromServer() {
            try {
                const response = await fetch('/user/profileviews', {
                    method: 'get',
                    credentials: 'include'
                });
                const data = await response.json();
                if (data.success) {
                    const viewsCountElement = document.getElementById('profile_viewers_count');
                    viewsCountElement.textContent = data.profileViews;
                }
            } catch (error) {
                console.error('Update profile views count error:', error);
            }
        }

        async function updateConnectionsCountFromServer() {
            
            try {
                const response = await fetch('/user/connection/count', {
                    method: 'get',
                    credentials: 'include'
                });
                const data = await response.json();
                if (data.success) {
                    const viewsCountElement = document.getElementById('connections-count');
                    viewsCountElement.textContent = data.connectionsCount;
                }
            } catch (error) {
                console.error('Update profile views count error:', error);
            }
        }

        async function loadAllCommentCounts() {
            const postElements = document.querySelectorAll('article[data-post-id]');
            for (const postElement of postElements) {
                const postId = postElement.dataset.postId;
                try {
                    const response = await fetch(`/post/comments/count/${postId}`);
                    const data = await response.json();
                    if (data.success) {
                        const commentsCountElement = postElement.querySelector('.comments-count');
                        commentsCountElement.textContent = `${data.count} comments`;
                    }
                } catch (error) {
                    console.error('Load comment count error:', error);
                }
            }
        }

        async function loadAllLikesInfo() {
            const postElements = document.querySelectorAll('article[data-post-id]');
            for (const postElement of postElements) {
                const postId = postElement.dataset.postId;
                try {
                    const response = await fetch(`/post/likes/${postId}`, {
                        credentials: 'include'
                    });
                    const data = await response.json();
                    if (data.success) {
                        const likesCountElement = postElement.querySelector('.likes-count');
                        likesCountElement.textContent = `${data.likesCount} likes`;
                        
                        // Update like button state
                        const likeBtn = postElement.querySelector('.like-btn');
                        const likeSvg = likeBtn.querySelector('svg');
                        if (data.isLiked) {
                            likeBtn.classList.add('liked', 'text-blue-500');
                            likeBtn.classList.remove('text-gray-400')
                            likeSvg.classList.add('fill-current');
                            likeSvg.classList.remove('fill-none');
                            
                        } else {
                            likeBtn.classList.remove('liked', 'text-blue-500');
                            likeSvg.classList.add('fill-none');
                            likeSvg.classList.remove('fill-current');
                        }
                    }
                } catch (error) {
                    console.error('Load likes info error:', error);
                }
            }
        }

        async function loadComments(postId) {
            try {
                const response = await fetch(`/post/comments/${postId}`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    displayComments(postId, data.comments);
                }
            } catch (error) {
                console.error('Load comments error:', error);
            }
        }

        async function addComment(postId, text) {
            try {
                const response = await fetch(`/post/comment/${postId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ text })
                });

                const data = await response.json();

                if (data.success) {
                    // Reload comments for this post
                    await loadComments(postId);
                    // Update comments count
                    await updateCommentsCountFromServer(postId);
                } else {
                    displayMessage(data.message || 'Failed to add comment', 'error');
                }
            } catch (error) {
                console.error('Add comment error:', error);
                displayMessage('Failed to add comment', 'error');
            }
        }

        async function deleteComment(commentId) {
            try {
                const response = await fetch(`/post/comment/${commentId}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    // Remove the comment from UI
                    const commentElement = document.querySelector(`[data-comment-id="${commentId}"]`);
                    if (commentElement) {
                        // Find the post ID from the comments section
                        const commentsSection = commentElement.closest('.comments-section');
                        const postId = commentsSection.dataset.postId;
                        commentElement.remove();
                        // Update comments count
                        await upd
                        ateCommentsCountFromServer(postId);
                    }
                     displayMessage(data.message );
                } else {
                    displayMessage(data.message || 'Failed to delete comment', 'error');
                }
            } catch (error) {
                console.error('Delete comment error:', error);
                displayMessage('Failed to delete comment', 'error');
            }
        }

function displayComments(postId, comments) {
    const commentsList = document.querySelector(`.comments-section[data-post-id="${postId}"] .comments-list`);

    // 1. Get User ID from EJS
    const currentUserId = '<%= user ? user._id : "" %>';

    // 2. Get Admin Status from EJS
    // This outputs "true" or "false" directly into the script
  
        const currentUserIsAdmin = "<%= user && user.isAdmin %>" === 'true';

    if (comments.length === 0) {
        commentsList.innerHTML = '<div class="text-center text-gray-500 text-sm py-2">No comments yet</div>';
        return;
    }

    const commentsHtml = comments.map(comment => {
        
        // 3. CHECK: Is user the owner OR is user an Admin?
        // Note: We use the 'currentUserIsAdmin' variable we created above
        const canDelete = (comment.user._id === currentUserId) || currentUserIsAdmin;

        return `
            <div class="flex gap-3 py-2" data-comment-id="${comment._id}">
                <img src="${comment.user.profilePicture || '/uploads/default-avatars/default.png'}" alt="${comment.user.username}" class="w-8 h-8 rounded-full flex-shrink-0 object-cover">
                <div class="flex-1">
                    <div class="bg-darkbg rounded-lg px-3 py-2">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-sm text-white">${comment.user.username}</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-400">${new Date(comment.date).toLocaleDateString()}</span>
                                
                                ${canDelete ? `
                                    <button class="delete-comment-btn text-gray-400 hover:text-red-400 text-xs" data-comment-id="${comment._id}" title="Delete comment">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                ` : ''}

                            </div>
                        </div>
                        <p class="text-sm text-gray-300 mt-1">${comment.text}</p>
                    </div>
                </div>
            </div>
        `;
    }).join('');

    commentsList.innerHTML = commentsHtml;
}

        function updateCommentsCount(postId, change) {
            const commentsCountElement = document.querySelector(`article[data-post-id="${postId}"] .comments-count`);
            if (commentsCountElement) {
                const currentCount = parseInt(commentsCountElement.textContent.split(' ')[0]) || 0;
                const newCount = Math.max(0, currentCount + change);
                commentsCountElement.textContent = `${newCount} comments`;
            }
        }

        async function updateCommentsCountFromServer(postId) {
            try {
                const response = await fetch(`/post/comments/count/${postId}`);
                const data = await response.json();
                if (data.success) {
                    const commentsCountElement = document.querySelector(`article[data-post-id="${postId}"] .comments-count`);
                    if (commentsCountElement) {
                        commentsCountElement.textContent = `${data.count} comments`;
                    }
                }
            } catch (error) {
                console.error('Update comment count error:', error);
            }
        }

        // --- POST CREATION FUNCTIONALITY ---
const startPostBtn = document.getElementById('start-post-btn');
const postModal = document.getElementById('post-modal');
const closeModalBtn = document.getElementById('close-modal');
const postForm = document.getElementById('post-form');
const postContentTextarea = document.getElementById('post-content');
const postSubmitBtn = document.getElementById('post-submit-btn');

// New Elements for Image Handling
const addPhotoBtn = document.getElementById('add-photo-btn');
const postImageInput = document.getElementById('post-image-input');
const imagePreviewContainer = document.getElementById('image-preview-container');
const imagePreview = document.getElementById('image-preview');
const removeImageBtn = document.getElementById('remove-image-btn');

let selectedFile = null;

// --- Helper Functions ---

// Check if form should be enabled (valid if text exists OR image exists)
function updateSubmitButtonState() {
    const content = postContentTextarea.value.trim();
    const hasImage = !!selectedFile;
    // Enable button if there is text OR an image
    postSubmitBtn.disabled = (content.length === 0 && !hasImage);
}

// Clear modal state
function resetModal() {
    postContentTextarea.value = '';
    selectedFile = null;
    postImageInput.value = ''; // Reset file input
    imagePreview.src = '';
    imagePreviewContainer.classList.add('hidden');
    postModal.classList.add('hidden');
    updateSubmitButtonState();
}

// --- Event Listeners ---

// Open Modal
startPostBtn.addEventListener('click', () => {
    postModal.classList.remove('hidden');
    postContentTextarea.focus();
});

// Close Modal
closeModalBtn.addEventListener('click', resetModal);

// Close when clicking outside
postModal.addEventListener('click', (e) => {
    if (e.target === postModal) {
        resetModal();
    }
});

// Monitor Text Input
postContentTextarea.addEventListener('input', updateSubmitButtonState);

// --- Image Handling Logic ---

// 1. Trigger hidden file input when "Photo" button is clicked
addPhotoBtn.addEventListener('click', () => {
    postImageInput.click();
});

// 2. Handle File Selection
postImageInput.addEventListener('change', (e) => {
    if (e.target.files && e.target.files[0]) {
        selectedFile = e.target.files[0];
        
        // Create preview URL
        const reader = new FileReader();
        reader.onload = (e) => {
            imagePreview.src = e.target.result;
            imagePreviewContainer.classList.remove('hidden');
        };
        reader.readAsDataURL(selectedFile);
        
        updateSubmitButtonState();
    }
});

// 3. Remove Image
removeImageBtn.addEventListener('click', () => {
    selectedFile = null;
    postImageInput.value = ''; // Important: allows selecting same file again if needed
    imagePreviewContainer.classList.add('hidden');
    imagePreview.src = '';
    updateSubmitButtonState();
});

// --- Form Submission ---

postForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const content = postContentTextarea.value.trim();
    
    // Guard clause: ensure there is something to post
    if (!content && !selectedFile) return;

    postSubmitBtn.disabled = true;
    postSubmitBtn.textContent = 'Posting...';

    // Create FormData object (Required for file uploads)
    const formData = new FormData();
    formData.append('content', content);
    
    if (selectedFile) {
        // 'image' must match the field name your backend expects (e.g., upload.single('image'))
        formData.append('image', selectedFile); 
    }

    try {
        const response = await fetch('/post/save', {
            method: 'POST',
            // IMPORTANT: Do NOT set 'Content-Type': 'application/json' or 'multipart/form-data'.
            // The browser automatically sets the Content-Type with the boundary for FormData.
            credentials: 'include', 
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            displayMessage('Post created successfully!', 'success');
            resetModal();

            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            displayMessage(data.message || 'Failed to create post', 'error');
            postSubmitBtn.disabled = false;
            postSubmitBtn.textContent = 'Post';
        }
    } catch (error) {
        console.error('Post creation error:', error);
        displayMessage('Network error', 'error');
        postSubmitBtn.disabled = false;
        postSubmitBtn.textContent = 'Post';
    }
});

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !postModal.classList.contains('hidden')) {
                postModal.classList.add('hidden');
                postContentTextarea.value = '';
                postSubmitBtn.disabled = true;
            }
        });
        
        
    </script>



</body>
</html>